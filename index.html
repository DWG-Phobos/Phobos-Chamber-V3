<html>
	<head>
		<title>Phobos: Answer or Die</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
		<script src='js/OrbitControls.js'></script>
		<script src='js/ColladaLoader.js'></script>
		<script>
			
			var scene = new THREE.Scene(); // Escena
						
			var camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.5, 1000 );
            camera.position.z = 6;
			camera.position.y = -8.5;
            camera.rotation.x = 75 * Math.PI / 180;
		

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );	// Tamany de la pantalla de renderitzat
			document.body.appendChild( renderer.domElement );	// Coloquem el render al document web
			

			//Controls: uncoment to freely navigate the zone
			//var controls = new THREE.OrbitControls(camera);

			//Charge Model
			var loadingManager = new THREE.LoadingManager( function() {

			scene.add( player );

			} );
			
			var loader = new THREE.ColladaLoader( loadingManager );
			var clock = new THREE.Clock(),
			mixer;

			loader.options.convertUpAxis = true;
			loader.load( 'models/Hero_alter/Hero.dae', function ( collada ) {
				
				player = collada.scene;
				player.rotation.x = 1.5;
				player.scale.set(0.03,0.03,0.03);
				
				var sceneAnimationClip = collada.animations[0];
				
				mixer = new THREE.AnimationMixer(player);
				
				var sceneAnimation = mixer.clipAction(sceneAnimationClip);
				sceneAnimation.play();
				
/*
				
				var modelMesh = collada.scene;
				modelMesh.traverse( function (child) {
				if (child instanceof THREE.SkinnedMesh) {
					var animation = new THREE.Animation(child,
					child.geometry.animation);
					animation.play();
					}
				});
*/
			} );
			
			var ambientLight = new THREE.AmbientLight( 0xffffff, 0.5 );
            scene.add( ambientLight );

            var light1 = new THREE.PointLight( 0xcc0000, 0.4, 100 );
            light1.position.set( 10, 0, 20 );
            scene.add( light1 );

            var light2 = new THREE.PointLight( 0x00cc00, 0.4, 100 );
            light2.position.set( 0, 0, 20 );
            scene.add( light2 );

            var light3 = new THREE.PointLight( 0x0000cc, 0.4, 100 );
            light3.position.set( -10, 0, 10 );
            scene.add( light3 );
			
			var lightX = new THREE.PointLight( 0x00ff00, 0.7, 15 );
            lightX.position.set( 0, 0, 0 );
            scene.add( lightX );
			
			mesh = new THREE.Object3D();
	
			//Creating Obstacles

				//Creating Cubes
				var largeCubeGeometry = new THREE.BoxGeometry( 5, 1, 2 ); //Crear Geometria
				var halfGiantGeometry = new THREE.BoxGeometry(9, 5, 2.5);
				var cubeGeometry = new THREE.BoxGeometry( 1, 1, 1 ); //Crear Geometria
				var tallCubeGeometry = new THREE.BoxGeometry( 1, 1, 2 ); //Crear Geometria
				var giantGeometry = new THREE.BoxGeometry(9,10,5);
				var platformGeometry = new THREE.BoxGeometry(2,2,1);
				

				var material = new THREE.MeshBasicMaterial( { color: "gray" } ); //Crear color
				var materialAlternatiu = new THREE.MeshBasicMaterial( { color: 0xFF7C00 } ); //Crear color
				
				var largeCube1 = new THREE.Mesh( largeCubeGeometry, material ); //Crear objecte
				var largeCube2 = new THREE.Mesh( largeCubeGeometry, material ); //Crear objecte
				var largeCube3 = new THREE.Mesh( largeCubeGeometry, material ); //Crear objecte
				var largeCube4 = new THREE.Mesh( largeCubeGeometry, material ); //Crear objecte
				var largeCube5 = new THREE.Mesh( largeCubeGeometry, material ); //Crear objecte
				var cube1 = new THREE.Mesh( cubeGeometry, material ); //Crear objecte
				var cube2 = new THREE.Mesh( cubeGeometry, material ); //Crear objecte
				var tallCube = new THREE.Mesh( tallCubeGeometry, material ); //Crear objecte
				var giantCube = new THREE.Mesh( giantGeometry, material ); //Crear objecte
				var giantCube2 = new THREE.Mesh( giantGeometry, material ); //Crear objecte
				var platform = new THREE.Mesh( platformGeometry, materialAlternatiu);
				var platform2 = new THREE.Mesh( platformGeometry, materialAlternatiu);
				var step1 = new THREE.Mesh(halfGiantGeometry, materialAlternatiu);
				//Cubes values
				cube1.position.set(-0.5, 30, 2.5);
				cube2.position.set(-2, 31, 0.5);
				tallCube.position.set(0.5, 30, 3);
				largeCube1.position.set(-5, 10, 1);
				largeCube2.position.set(-7.5, 20, 1);
				largeCube3.position.set(-1.5, 30, 1);
				largeCube4.position.set(-5, 40, 1);
				largeCube5.position.set(-7.5, 50, 1);
				giantCube.position.set(5.5, 11, 2.5);
				giantCube2.position.set(5.5, 30, 2.5);
				platform.position.set(2, 19, 4.5);
				platform2.position.set(5, 22, 4.5);
				step1.position.set(5.5,37.5, 1.2)
				//Adding Cubes to the Mesh
				mesh.add(cube1);
				mesh.add(cube2);
				mesh.add(largeCube1);
				mesh.add(largeCube2);
				mesh.add(largeCube3);
				mesh.add(largeCube4);
				mesh.add(largeCube5);
				mesh.add(tallCube);
				mesh.add(giantCube);
				mesh.add(giantCube2);
				mesh.add(platform);
				mesh.add(platform2);
				mesh.add(step1);
				//Creating Triangles
				var geometry = new THREE.Geometry();

			    geometry.vertices = [
			        new THREE.Vector3( 1, 1, 0 ),
			        new THREE.Vector3( 10, 1, 0 ),
			        new THREE.Vector3( 1, 6, 0 ),
			        new THREE.Vector3( 10, 6, 0 ),
			        new THREE.Vector3( 1, 6, 5 ),
			        new THREE.Vector3( 10, 6, 5 )
			    ];
			    
			    geometry.faces = [
			        new THREE.Face3( 2, 1, 0),
			        new THREE.Face3( 1, 2, 3),
			        new THREE.Face3( 4, 2, 0),
			        new THREE.Face3( 1, 3, 5),
			        new THREE.Face3( 0, 1, 4 ),
			        new THREE.Face3( 5, 4, 1),
			        new THREE.Face3( 2, 4, 5,),
			        new THREE.Face3( 5, 3, 2,)
			    ];
				
			    var triangle = new THREE.Mesh( geometry, material );
			    mesh.add(triangle);

			//Creating World	

				//Creating the ground
				var groundGeometry = new THREE.PlaneGeometry(20, 100);
				var material1 = new THREE.MeshBasicMaterial( { color: "red" } ); //Crear color
				var materialGround = new THREE.MeshBasicMaterial( {color: 0xaa3f39});
				var ground = new THREE.Mesh(groundGeometry, materialGround);

				//Creating the walls
				var wallGeometry = new THREE.PlaneGeometry(10, 100);
				var wallMaterial = new THREE.MeshBasicMaterial( { color: "blue" } ); //Crear color
				var rightWall = new THREE.Mesh(wallGeometry, wallMaterial);
				var leftWall = new THREE.Mesh(wallGeometry, wallMaterial);

				//Ground values
				ground.position.y = 30;

				//Right Wall Values
				rightWall.position.x = 10;
				rightWall.position.y = 30;
				rightWall.position.z = 5;
				
				rightWall.rotation.y = -Math.PI / 2;

				//Left Wall Values

				leftWall.position.x = -10;
				leftWall.position.y = 30;
				leftWall.position.z = 5;

				leftWall.rotation.y = Math.PI / 2;

				//Adding Walls and Ground to the Mesh
				mesh.add(ground);
				mesh.add(leftWall);
				mesh.add(rightWall);

			//Create answers
                var answerBoxGeometry = new THREE.BoxGeometry(5,5,0.5);

                var materialA = new THREE.MeshBasicMaterial( { color: "green" } ); //Crear color
                var materialB = new THREE.MeshBasicMaterial( { color: "yellow" } ); //Crear color
                var materialC = new THREE.MeshBasicMaterial( { color: "blue" } ); //Crear color
                var materialD = new THREE.MeshBasicMaterial( { color: "red" } ); //Crear color

                var answerBoxA = new THREE.Mesh( answerBoxGeometry, materialA);
                var answerBoxB = new THREE.Mesh( answerBoxGeometry, materialB);
                var answerBoxC = new THREE.Mesh( answerBoxGeometry, materialC);
                var answerBoxD = new THREE.Mesh( answerBoxGeometry, materialD);

                answerBoxA.position.set(-7.5, 60, 0.25);
                answerBoxB.position.set(-2.5, 60, 0.25);
                answerBoxC.position.set(2.5, 60, 0.25);
                answerBoxD.position.set(7.5, 60, 0.25);

                mesh.add(answerBoxA);
                mesh.add(answerBoxB);
                mesh.add(answerBoxC);
                mesh.add(answerBoxD);
			

			//Adding all objects to the Scene
			scene.add(mesh);


			//Function that renders the scene
			var animate = function () {

				requestAnimationFrame( animate );
				
				var delta = clock.getDelta();
				if( mixer ) {
					mixer.update( delta );
				}
				
				renderer.render(scene, camera);
			};
			
			animate();

		</script>
	</body>
</html>
